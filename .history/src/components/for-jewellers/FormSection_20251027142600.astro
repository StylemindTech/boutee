---
// src/components/for-jewellers/FormSection.astro
--- 
<section id="form-section" class="md:py-section-padding-desktop py-component-gap-medium">
  <div class="max-w-container-max-width px-container-padding-mobile lg:px-container-padding-desktop mx-auto">
    <div class="flex items-center justify-center">
      <div class="bg-cardColor rounded-xxxl md:py-[88px] lg:px-[200px] px-container-padding-mobile py-component-gap-medium w-full">
        <h2 class="lg:text-hero-mobile text-heading-mobile lg:leading-[120%] leading-heading-mobile font-bold text-center mb-text-gap-medium font-ppradio text-textPrimary">
          Ready to meet your next customer?
        </h2>
        <p class="lg:text-body-desktop text-body-mobile lg:leading-large-mobile leading-body-mobile text-center lg:mb-heading-margin-top-desktop mb-xs font-figtree text-textPrimary">
          If you believe your work is a good fit for our platform, we would love to hear from you. <br>
          Please introduce yourself using the form below, and our partnerships team will be in touch.
        </p>

        <form id="jeweller-form" class="lg:space-y-xl space-y-s">
          <!-- Name + Brand Name -->
          <div class="grid md:grid-cols-2 gap-xs md:gap-m mb-xs md:mb-m">
            <input 
              type="text" 
              name="name"
              placeholder="Name *"
              required
              class="w-full px-s py-[14px] text-[15px] leading-[18px] text-textPrimary focus:outline-none focus:ring-2 focus:ring-btnPrimary bg-white border border-borderOutline rounded-m" 
            />
            <input 
              type="text" 
              name="brandName"
              placeholder="Brand Name *"
              required
              class="w-full px-s py-[14px] text-[15px] leading-[18px] text-textPrimary focus:outline-none focus:ring-2 focus:ring-btnPrimary bg-white border border-borderOutline rounded-m" 
            />
          </div>

          <!-- Email + Website -->
          <div class="grid md:grid-cols-2 gap-xs md:gap-m mb-xs md:mb-m">
            <input 
              type="email" 
              name="email"
              placeholder="Email *"
              required
              class="w-full px-s py-[14px] text-[15px] leading-[18px] text-textPrimary focus:outline-none focus:ring-2 focus:ring-btnPrimary bg-white border border-borderOutline rounded-m" 
            />
            <input 
              type="url" 
              name="website"
              placeholder="Website"
              class="w-full px-s py-[14px] text-[15px] leading-[18px] text-textPrimary focus:outline-none focus:ring-2 focus:ring-btnPrimary bg-white border border-borderOutline rounded-m" 
            />
          </div>

          <!-- Instagram -->
          <input 
            type="text" 
            name="instagram"
            placeholder="Instagram Handle"
            class="w-full px-s py-[14px] text-[15px] leading-[18px] text-textPrimary focus:outline-none focus:ring-2 focus:ring-btnPrimary bg-white border border-borderOutline rounded-m mb-xs md:mb-m" 
          />

          <!-- Message -->
          <textarea 
            rows="3" 
            name="message"
            placeholder="Message (optional)"
            class="w-full min-h-[88px] px-s py-[14px] text-[15px] leading-[18px] text-textPrimary focus:outline-none focus:ring-2 focus:ring-btnPrimary bg-white border border-borderOutline rounded-m mb-xs md:mb-m resize-none"
          ></textarea>

          <!-- Terms -->
          <div class="flex gap-xxs lg:mt-2">
            <div>
              <input 
                type="checkbox" 
                id="terms"
                name="terms"
                required
                class="cursor-pointer checkbox-custom w-[20px] h-[20px] appearance-none rounded-xxs border-2 border-gray-800" 
              />
            </div>
            <label for="terms" class="cursor-pointer text-textPrimary text-body-mobile leading-body-mobile">
              I accept the <a href="/terms-of-service" class="underline">Terms of Service</a> and 
              <a href="/privacy-policy" class="underline">Privacy Policy</a>
            </label>
          </div>

          <!-- Error message -->
          <div id="form-error" class="hidden text-red-600 text-body-mobile leading-body-mobile text-center font-figtree"></div>

          <!-- Success message -->
          <div id="form-success" class="hidden text-green-600 text-body-mobile leading-body-mobile text-center font-figtree">
            Thank you! We've received your application and will be in touch soon.
          </div>

          <!-- Button -->
          <div class="text-center lg:mt-heading-margin-top-desktop mt-s">
            <button 
              type="submit"
              id="submit-button"
              class="cursor-pointer bg-btnPrimary mx-auto text-white text-body-mobile leading-body-mobile py-button-padding-y min-h-[56px] min-w-[194px] px-button-padding-x-desktop rounded-full font-figtree font-medium flex items-center gap-3 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span id="button-text">Submit Introduction</span>
              <span id="button-loader" class="hidden">
                <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<style>
  .checkbox-custom:checked {
    background-color: #1a1a1a;
    background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('jeweller-form') as HTMLFormElement;
    const submitButton = document.getElementById('submit-button') as HTMLButtonElement;
    const buttonText = document.getElementById('button-text');
    const buttonLoader = document.getElementById('button-loader');
    const errorDiv = document.getElementById('form-error');
    const successDiv = document.getElementById('form-success');

    if (!form) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Hide previous messages
      errorDiv?.classList.add('hidden');
      successDiv?.classList.add('hidden');
      
      // Disable button and show loader
      submitButton.disabled = true;
      buttonText?.classList.add('hidden');
      buttonLoader?.classList.remove('hidden');

      try {
        const formData = new FormData(form);
        const data = {
          name: formData.get('name') as string,
          brandName: formData.get('brandName') as string,
          email: formData.get('email') as string,
          website: formData.get('website') as string,
          instagram: formData.get('instagram') as string,
          message: formData.get('message') as string,
        };

        const response = await fetch('/api/send-email', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        const result = await response.json();

        if (response.ok && result.success) {
          // Show success message
          successDiv?.classList.remove('hidden');
          // Reset form
          form.reset();
          
          // Scroll to success message
          successDiv?.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
          throw new Error(result.error || 'Something went wrong');
        }
      } catch (error) {
        // Show error message
        if (errorDiv) {
          errorDiv.textContent = error instanceof Error ? error.message : 'Failed to submit application. Please try again.';
          errorDiv.classList.remove('hidden');
          errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      } finally {
        // Re-enable button and hide loader
        submitButton.disabled = false;
        buttonText?.classList.remove('hidden');
        buttonLoader?.classList.add('hidden');
      }
    });
  });
</script>